#!/bin/dash

# Increment, decrement, mute, or unmute the volume using Pipewire and send a notification
SWAYNC_REPLACES_ID="9898"
ICON_PATH="/home/deanr/.local/share/icons/dunst"

get_volume() {
	wpctl get-volume @DEFAULT_AUDIO_SINK@ | awk '{print int($2 * 100)}'
}

case $1 in
	up)
		# Set the volume on (if it was muted)
		wpctl set-mute @DEFAULT_AUDIO_SINK@ 0
		VOLUME=$(get_volume)
		if [ "$VOLUME" -lt 100 ]; then
			wpctl set-volume @DEFAULT_AUDIO_SINK@ 2%+
		fi
		;;
	down)
		wpctl set-mute @DEFAULT_AUDIO_SINK@ 0
		wpctl set-volume -l 2.0 @DEFAULT_AUDIO_SINK@ 2%-
		;;
	mute)
		wpctl set-mute @DEFAULT_AUDIO_SINK@ toggle
		;;
	unmute)
		# Unmute the volume if muted
		wpctl set-mute @DEFAULT_AUDIO_SINK@ 0
		;;
esac

VOLUME=$(wpctl get-volume @DEFAULT_AUDIO_SINK@ | tr -dc '0-9' | sed 's/^0\{1,2\}//')

send_notification() {
	if [ "$1" = "mute" ]; then ICON="mute"; elif [ "$VOLUME" -lt 20 ]; then ICON="low"; elif [ "$VOLUME" -lt 60 ]; then ICON="medium"; else ICON="high"; fi
	if [ "$1" = "mute" ]; then TEXT="Currently muted"; else TEXT="Currently at ${VOLUME}%"; fi

    notify-send -a "Volume" \
        -u normal \
        -t 2000 \
        -h int:value:"$VOLUME" \
        -h string:synchronous:volume \
        "Volume" "$TEXT"
}

case $1 in
	mute)
		case "$(wpctl get-volume @DEFAULT_AUDIO_SINK@)" in
			*MUTED* ) send_notification mute;;
			*       ) send_notification;;
		esac;;
	unmute)
		send_notification;;
	*)
		send_notification;;
esac

