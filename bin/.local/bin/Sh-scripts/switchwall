#!/bin/dash

WALLPAPER_DIR="$HOME/.local/share/wallpapers/"
WALLPAPER_CONFIG_FILE="$HOME/.config/hypr/.current_wallpaper"
ICON_PATH="$HOME/.local/share/nt-icons/wallpaper.png"

SELECTED_WALLPAPER=$(find "$WALLPAPER_DIR" -type f -printf "%P\n" | rofi -dmenu -i -p "Wallpaper: ")

if [ -z "$SELECTED_WALLPAPER" ]; then
  echo "No wallpaper selected."
  exit 1
fi

WALLPAPER_PATH="$WALLPAPER_DIR/$SELECTED_WALLPAPER"

mkdir -p "$(dirname "$WALLPAPER_CONFIG_FILE")"
echo "$WALLPAPER_PATH" > "$WALLPAPER_CONFIG_FILE"

swww img "$WALLPAPER_PATH" --transition-type=fade --transition-step 120 --transition-fps 100

HYPRLOCK_CONFIG_PATH="$HOME/.config/hypr/hyprlock.conf"

sed -i "s|^    path =.*|    path = $WALLPAPER_PATH|g" "$HYPRLOCK_CONFIG_PATH"

notify-send "Wallpaper changed!" -r 9898 -u normal "Successfully changed wallpaper to $SELECTED_WALLPAPER" -i "$ICON_PATH"

