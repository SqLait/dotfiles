#!/bin/sh

WALLPAPER_DIR="$HOME/.local/share/wallpapers"
WALLPAPER_CONFIG_FILE="$HOME/.config/hypr/.current_wallpaper"
ICON_PATH="$HOME/.local/share/icons/dunst/wallpaper-switch.png"

# Use rofi to select a wallpaper
SELECTED_WALLPAPER=$(ls "$WALLPAPER_DIR" | sed 's/^//' | rofi -dmenu -i -p "Wallpaper ï€‚ ")

# Check if a wallpaper was selected
if [ -z "$SELECTED_WALLPAPER" ]; then
  echo "No wallpaper selected."
  exit 1
fi

# Full path to the selected wallpaper
WALLPAPER_PATH="$WALLPAPER_DIR/$SELECTED_WALLPAPER"

# Save the selected wallpaper path to the configuration file
mkdir -p "$(dirname "$WALLPAPER_CONFIG_FILE")"
echo "$WALLPAPER_PATH" > "$WALLPAPER_CONFIG_FILE"

# Update the wallpaper using swww
swww img "$WALLPAPER_PATH" --transition-type=grow --transition-step 175 --transition-fps 175

HYPRLOCK_CONFIG_PATH="$HOME/.config/hypr/hyprlock.conf"

# Use 'sed' to replace the 'path' variable in the background section
sed -i "s|^    path =.*|    path = $WALLPAPER_PATH|g" "$HYPRLOCK_CONFIG_PATH"

# Notify the user with an icon
notify-send "Wallpaper changed!" -r 9898 -u normal "Successfully changed wallpaper to $SELECTED_WALLPAPER" -i "$ICON_PATH"

